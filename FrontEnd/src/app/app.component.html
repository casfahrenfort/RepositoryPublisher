<div class="view">
  <div class=" main-container">
    <div class="topBar">
      <button class="btn btn-success" (click)="publishAllRepos()">
        Publish {{getButtonText()}}
        <span *ngIf="publishing" class="spin spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      </button>
      <button class="btn btn-info" (click)="addRepo()" [disabled]="publishing">Add repository</button>
    </div>
    <ngb-tabset type="pills">
      <ngb-tab *ngFor="let form of publishForms; let i = index" title="{{getTabName(form, i)}}">
        <ng-template ngbTabContent>
          <form [formGroup]="form">
            <ngb-accordion #a="ngbAccordion" activeIds="custom-panel-1">
              <ngb-panel id="custom-panel-1">
                <ng-template ngbPanelHeader let-opened="opened">
                  <div class="d-flex align-items-center justify-content-between">
                    <h6 class="m-0 accordion-title">Repository information</h6>
                  </div>
                </ng-template>
                <ng-template ngbPanelContent>
                  <h6>Version Control System</h6>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="vcsRadios1" value="git" checked
                      formControlName="vcs">
                    <label class="form-check-label" for="vcsRadios1" (click)="setVCS(0)">
                      Git
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="vcsRadios2" value="svn" formControlName="vcs">
                    <label class="form-check-label" for="vcsRadios2" (click)="setVCS(1)">
                      Subversion
                    </label>
                  </div>
                  <br>
                  <div *ngIf="getTabVcs(form)=='git'">
                    <label for="url">Repository URL <span class="required">*</span></label>
                    <input type="text" class="form-control form-control-sm" id="url" aria-describedby="urlHelp"
                      placeholder="https://github.com/author/repository" formControlName="url">
                    <small id="urlHelp" class="form-text text-muted">The web URL to your <i>public</i> GitHub
                      repository.</small>
                    <br>

                    <label for="name">Repository name <span class="required">*</span></label>
                    <input type="text" class="form-control form-control-sm" id="name" placeholder=""
                      formControlName="name">
                  </div>

                  <div *ngIf="getTabVcs(form)=='svn'">
                    <label for="url">Repository URL <span class="required">*</span></label>
                    <input type="text" class="form-control form-control-sm" id="url" aria-describedby="urlHelp"
                      placeholder="" formControlName="url">
                    <small id="urlHelp" class="form-text text-muted">The web URL to your <i>public</i> SVN
                      repository.</small>
                    <br>

                    <label for="name">Repository name <span class="required">*</span></label>
                    <input type="text" class="form-control form-control-sm" id="name" placeholder=""
                      formControlName="name">
                  </div>
                </ng-template>
              </ngb-panel>
              <ngb-panel id="custom-panel-1">
                <ng-template ngbPanelHeader let-opened="opened">
                  <div class="d-flex align-items-center justify-content-between">
                    <h6 class="m-0 accordion-title">Publishing information</h6>
                  </div>
                </ng-template>
                <ng-template ngbPanelContent>
                  <h6>Publishing Environment</h6>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="pidRadios1" value="b2share" checked
                      formControlName="ps">
                    <label class="form-check-label" for="pidRadios1" (click)="setPID(0)">
                      EUDAT - B2SHARE
                    </label>
                  </div>
                  <br>
                  <label for="token">Access Token <span class="required">*</span></label>
                  <input type="text" class="form-control form-control-sm" id="token" aria-describedby="tokenHelp"
                    placeholder="">
                  <small id="tokenHelp" class="form-text text-muted">Your B2SHARE access token.</small>
                </ng-template>
              </ngb-panel>
              <ngb-panel id="custom-panel-1">
                <ng-template ngbPanelHeader let-opened="opened">
                  <div class="d-flex align-items-center justify-content-between">
                    <h6 class="m-0 accordion-title">Publication Metadata</h6>
                  </div>
                </ng-template>
                <ng-template ngbPanelContent>
                  <h6>Publication type</h6>
                  <div class="form-check check-vertical">
                    <input class="form-check-input" type="radio" id="typeRadios1" value="software" checked
                      formControlName="type">
                    <label class="form-check-label" for="typeRadios1" (click)="setVCS(0)">
                      Software
                    </label>
                  </div>
                  <div class="form-check check-vertical">
                    <input class="form-check-input" type="radio" id="typeRadios2" value="media" formControlName="type">
                    <label class="form-check-label" for="typeRadios2" (click)="setVCS(1)">
                      Media
                    </label>
                  </div>
                  <div class="form-check check-vertical">
                    <input class="form-check-input" type="radio" id="typeRadios3" value="educational"
                      formControlName="type">
                    <label class="form-check-label" for="typeRadios3" (click)="setVCS(1)">
                      Educational
                    </label>
                  </div>
                  <br>

                  <h6>Basic information</h6>
                  <label for="date">Publication date <span class="required"> *</span></label>
                  <div class="form-group">
                    <div class="input-group">
                      <input class="form-control form-control-sm" placeholder="yyyy-mm-dd" name="date" ngbDatepicker
                        #d="ngbDatepicker" id="datepicker" #date>
                      <div class="input-group-append">
                        <button class="btn btn-outline-secondary calendar" (click)="d.toggle()" type="button"></button>
                      </div>
                    </div>
                  </div>
                  <br>
                  <label for="date">Author <span class="required"> *</span></label>
                  <input type="text" class="form-control form-control-sm" id="author" placeholder=""
                    formControlName="author">
                  <br>

                  <label for="date">Contributors</label>
                  <input type="text" class="form-control form-control-sm" id="contributors" placeholder=""
                    formControlName="contributors">
                  <br>

                  <label for="date">Version</label>
                  <input type="text" class="form-control form-control-sm" id="version" placeholder=""
                    formControlName="version">
                  <br>

                  <label for="date">Description <span class="required">*</span></label>
                  <textarea class="form-control form-control-sm" id="description" placeholder="" rows="5"
                    formControlName="description"></textarea>
                  <br>

                  <h6>Access rights</h6>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="open_access"
                      formControlName="open_access">
                    <label class="form-check-label" for="open_access">
                      Open access
                    </label>
                  </div>

                </ng-template>
              </ngb-panel>
            </ngb-accordion>
          </form>
        </ng-template>
      </ngb-tab>
    </ngb-tabset>
  </div>
</div>

<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      <span *ngIf="publishResult.publishUrl">Publication succesful</span>
      <span *ngIf="!publishResult.publishUrl">Publication failed</span>
    </h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div *ngIf="publishResult.publishUrl">
      Your repository has been published!

      It can be found <a href="{{publishResult.publishUrl}}">here</a>.
    </div>
    <div *ngIf="!publishResult.publishUrl">
      {{publishResult.error.message}}
    </div>
    <div *ngIf="publishResult.b2ShareResponse">
      <h6>B2Share Response</h6>
      message: {{publishResult.error.b2ShareResponse.message}}
      status: {{publishResult.error.b2ShareResponse.status}}
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close()">Close</button>
  </div>
</ng-template>